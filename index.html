<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Packaging d'une application de Machine Learning</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/white.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/base16/zenburn.css" />


  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

## Packaging <br>d'une application <br>de Machine Learning 

<img src="images/amener-son-projet-de-machine-learning-en-production-avec-wheel-et-docker.png" height="300" width="auto">

</script></section><section ><section data-markdown><script type="text/template">

## `$>` [Whoami](https://www.linkedin.com/in/mehdihouacine/) â“

<style>
#whoami td, #whoami th {
  border: none;
}
</style>

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://www.octo.com/wp-content/uploads/2019/03/expertises-OCTO.jpg.webp" class="white-text" -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(255, 255, 255); padding: 20px; font-size: 20px; text-align: center;">
  <h2>Consultant @ OCTO depuis 2017</h2>
  <img src="./images/logo-octo.jpeg" width="50px" style="margin: 0 !important;">
</div>

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1554475901-4538ddfbccc2?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2372&q=80" class="white-text" -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); padding: 20px; font-size: 20px; text-align: center;">
  <h2 style="color: white;">Touche-Ã -tout âš—ï¸</h2>
  <p style="color: white;">DÃ©v backend, frontend, Machine Learning, design d'expÃ©rience (UX)...</p>
</div>

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1524178232363-1fb2b075b655?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80" class="white-text" -->

<div style="position: absolute; width: 40%; left: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); padding: 20px; font-size: 20px; text-align: center;">
  <h2 style="color: white;">Instructeur de formation ğŸš¸</h2>
  <p style="color: white;">AgilitÃ©, MLOps, Data Science, <br>Automatisation d'infrastructure, Cloud</p>
</div>

</script></section><section data-markdown><script type="text/template">

![](./images/meetup.png)

Co-organisateur de ce Meetup â™¥ï¸


</script></section></section><section  data-markdown><script type="text/template">

## Avez-vous dÃ©jÃ  ...

... mis en prod' une application de ML ?

ğŸ§  â• ğŸ“¦ = ğŸ¤” 

<aside class="notes"><p>TODO sondage Mentimeter</p>
</aside></script></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="./images/lalit-kumar-HpPmiduLDC0-unsplash.jpg" class="white-text" -->

</script></section><section data-markdown><script type="text/template">

## DÃ©tection de <br>dÃ©fauts de qualitÃ©

### ğŸ§  + ğŸ“¸ = ğŸ’°

![schÃ©ma ligne d'assemblage](images/ligne-assemblage.png) <!-- .element: class="fragment" -->

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://media.giphy.com/media/J1Xh064pPyRWcNYaj6/giphy.gif" class="white-text" -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); padding: 20px; font-size: 20px; text-align: center;"><h2 style="color:white;">Quelques cas d'usages</h2><p>ğŸ­ ğŸ­ ğŸ­ </p></div>


</script></section><section data-markdown><script type="text/template">

## DÃ©fauts sur textile ğŸ•µï¸â€â™‚ï¸

|                                                 un bon pli                                                 |                                                un mauvais pli                                                |
| :--------------------------------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------------------------: |
| <img src="images/nordwood-themes-R53t-Tg6J4c-unsplash.jpg" width="300" height="auto" class="round-border"> | <img src="images/sharon-mccutcheon-WqPAETBU2G8-unsplash.jpg" width="300" height="auto" class="round-border"> |

</script></section><section data-markdown><script type="text/template">

## DÃ©fauts sur textile ğŸ•µï¸â€â™‚ï¸

|                                                 un bon pli                                                 |                                                     un mauvais pli                                                     |
| :--------------------------------------------------------------------------------------------------------: | :--------------------------------------------------------------------------------------------------------------------: |
| <img src="images/nordwood-themes-R53t-Tg6J4c-unsplash.jpg" width="300" height="auto" class="round-border"> | <img src="images/sharon-mccutcheon-WqPAETBU2G8-unsplash-predicted.png" width="300" height="auto" class="round-border"> |

</script></section><section data-markdown><script type="text/template">

## Et en vrac ...

|                                PrÃ©sence de composants                                 |                                    Etat de soudures                                    |                                  DÃ©tection de rayures                                  |
| :-----------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------: |
| <img src="images/sam-loyd-qy27JnsH9sU-unsplash.jpg" style="width:300px; height:auto"> | <img src="images/russ-ward-18MJRuL4tUE-unsplash.jpg" style="width:300px; height:auto"> | <img src="images/ty-feague-gnDbEnWFMWs-unsplash.jpg" style="width:300px; height:auto"> |




</script></section></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1598983870677-01e066a0b901?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80" class="white-text" -->


<h3 style="color: white;">La modÃ©lisation dure plus d'1 an</h3>

</script></section><section data-markdown><script type="text/template">

#### Ce qu'on aurait peut-Ãªtre dÃ» faire ğŸ˜

#### [Google Rule of ML #4](https://developers.google.com/machine-learning/guides/rules-of-ml?hl=fr#rule_4_keep_the_first_model_simple_and_get_the_infrastructure_right) 

> *Keep the first model simple <br>and get the infrastructure right*

</script></section><section data-markdown><script type="text/template">

### Au bout d'1 an

#### On fait enfin notre premiÃ¨re dÃ©mo en usine ğŸ’ª

<img src="./images/matos-usine.png" height="300" width="auto" class="round-border">

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background="images/asli-yilmaz-u1PX1Q26Kpo-unsplash.jpg" -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); padding: 20px; font-size: 20px; text-align: center;">
  <h4 style="color:white;">La dÃ©mo convainct âœ…</h4>
  <h4 style="color:white;">On a le Go pour aller en prod ! ğŸ—º ğŸ­</h4>
  <h4 style="color:white;">Et mÃªme pour passer Ã  l'Ã©chelle ! ğŸªœ ğŸªœ</h4>
</div>

</script></section></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1613464789351-24b80d158795?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80" -->

<h2 style="color: white">Prenons du recul</h2>

</script></section><section data-markdown><script type="text/template">

<img src="images/hidden-technical-debt-of-ml.png" height="300" width="auto" class="round-border">

<small>Il nous a fallu plus d'1 an pour adresser la petite boÃ®te noire ğŸ™€</small>
<small>C'est du temps qu'on aurait pu consacrer Ã  autre chose que la modÃ©lisation</small>
<small>(*Source : [Hidden Technical Debt in Machine Learning Systems](https://proceedings.neurips.cc/paper/2015/file/86df7dcfd896fcaf2674f757a2463eba-Paper.pdf)*)</small>

</script></section><section data-markdown><script type="text/template">

### Ce qu'on fait bien

### Ã  ce moment-lÃ  âœ…

- ğŸ Tests automatisÃ©s avec Pytest,
- ğŸ“ Bonnes mÃ©triques de qualitÃ© de code,
  - *Code coverage*, [Pyramide de tests](https://blog.octo.com/la-pyramide-des-tests-par-la-pratique-1-5/), ...
- ğŸ¦Š Pipeline `Gitlab-CI` de tests auto.

![](./images/pipeline-ci-tests-qualite.png)

</script></section><section data-markdown><script type="text/template">

## LÃ  oÃ¹ Ã§a pÃªche âŒ

### Mode d'emploi pour dÃ©ployer

- ğŸ›« Prendre l'avion dans l'usine cible
  - 24h avant l'Ã©chÃ©ance contractuelle

</script></section><section data-markdown><script type="text/template">

## LÃ  oÃ¹ Ã§a pÃªche âŒ

### Mode d'emploi pour dÃ©ployer

- ğŸ›  Passer la journÃ©e Ã  configurer le "PC de prod'"
  - ğŸ§Clean install' Linux
  - ğŸ Bonne version de Python,
  - âš™ï¸ Bons drivers GPU

</script></section><section data-markdown><script type="text/template">

## LÃ  oÃ¹ Ã§a pÃªche âŒ

### Mode d'emploi pour dÃ©ployer

- `$> git clone;` du repo oÃ¹ sont versionnÃ©s :
  - le code de ML, le code mÃ©tier
  - ğŸ§  et le modÃ¨le

</script></section><section data-markdown><script type="text/template">

## Constat ğŸ›«

Sans investir dans l'automatisation,

L'Ã©quipe passera son temps <br>en dÃ©placement pour dÃ©ployer ğŸ’¸

</script></section><section data-markdown><script type="text/template">

## On commence Ã  automatiser

- J'ai un mois pour automatiser le setup
  - ğŸ§Clean install' Linux
  - ğŸ Bonne version de Python,
  - âš™ï¸ Bons drivers GPU

- Je ne comprends rien au packaging en Python ğŸ¤·

![](./wtf-with-python-packaging.png)

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://media0.giphy.com/media/e24Q8FKE2mxRS/giphy.gif" -->

</script></section></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1600009723480-ae9ee0a74709?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=987&q=80" -->

<h2 style="color: white">Repartons <br>des bases du packaging</h2>

</script></section><section data-markdown><script type="text/template">

#### C'est quoi une app de Machine learning ?

<a href="https://martinfowler.com/articles/cd4ml.html">
    <img  src="https://martinfowler.com/articles/cd4ml/ml-axis-of-change.png">
</a>

<small>*Source : [Continuous Delivery for Machine Learning](https://martinfowler.com/articles/cd4ml.html)*</small>


</script></section><section data-markdown><script type="text/template">

### J'ai commencÃ© simple ...

### J'ai commencÃ© par un zip

```bash
.PHONY: package  ## ğŸ“¦ packaging de l'application en zip
package:
  zip -r object-detector.zip \
    ${path_to_code} ${path_to_model} ${path_to_data}
```

```bash
.PHONY: install-app  ## âš™ï¸ Code arbitraire Ã  exÃ©cuter chez vous si vous voulez vous servir de cette application
install-app: MY_OS := 'centOS'
  unzip object-detector.zip -d ${SITE_PACKAGES_DESTINATION_PATH}
  # Here be dragons ğŸ‰ğŸ‰ğŸ‰ ...
  mv ${SERVICE_FILE} ${SERVICE_PATH}
  $(MAKE) compilation_en_c OS=${MY_OS}
```

</script></section><section data-markdown><script type="text/template">

## Packaging avec un zip

- âœ… C'est simple, pratique, tout tient dans 1 archive

### Mais

- âŒ ExÃ©cution de code arbitraire <!-- .element: class="fragment" -->
- âŒ C'est de la maintenance en + <!-- .element: class="fragment" -->
- âŒ On se passe des outils standards proposÃ©s par l'Ã©co-systÃ¨me Python <!-- .element: class="fragment" -->

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background-iframe="https://peps.python.org/pep-0206/" -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(255, 255, 255, 0.9); padding: 20px; font-size: 20px; text-align: center;">
  <h2>ğŸ”‹ batteries <a href="https://peps.python.org/pep-0206/#batteries-included-philosophy">included</a></h2>
  <p>L'Ã©co-systÃ¨me Python se veut "auto-portant", en mettant Ã  disposition des outils prÃªt Ã  l'emploi pour permettre son plein usage</p>
</div>

</script></section></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1548741465-8b453e363e48?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2274&q=80" -->

<div style="position: absolute; width: 70%; left: 10%; box-shadow: 0 1px 4px rgba(0,0,0,0.7), 0 5px 25px rgba(0,0,0,0.5); background-color: rgba(0, 0, 0, 0.7); padding: 20px; font-size: 20px; text-align: center;">
  <h2 style="color:white;">
    ğŸ Le format Wheel â˜¸ï¸
  </h2>
  <h3 style="color:white;">
    Pour Ã©viter de rÃ©inventer la roue ğŸ¥ğŸ¥ğŸ¥
  </h3>
</div>

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background-iframe="https://packaging.python.org/en/latest/discussions/wheel-vs-egg/#:~:text=Wheel%20is%20currently%20considered%20the%20standard%20for%20built%20and%20binary%20packaging%20for%20Python." -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); padding: 20px; font-size: 20px; text-align: center;"><p style="color:white;">Wheel est le seul format officiellement prÃ©conisÃ© Ã  ce jour par <br>la <a href="https://www.pypa.io/en/latest/">Python Packaging Authority (PyPA)</a></p></div>

</script></section><section data-markdown><script type="text/template">

ğŸ Le format Wheel est un format de *packaging*, <br>et un <span style="text-decoration: underline;">**package**</span> c'est :


| PropriÃ©tÃ©                                      | Example                |
| :--------------------------------------------- | :--------------------- |
| Une **version**                                | `v1.4.1`               |
| Le **code**                                    | code ML \| mÃ©tier      |
| Des **metadata** <br>pour le *package manager* | pip \| apt \| yum      |
| Le tout dans une **archive**                   | zip \| tar.gz \| bzip2 |

</script></section><section data-markdown><script type="text/template">

## Comment Ã§a marche ?

- Les distributions Wheel se publient dans un dÃ©pÃ´t :
  - le *Python Package Index* ([PyPI](https://pypi.org/)),
- ğŸ“¦ğŸ“¦ Elles se gÃ©nÃ¨rent avec la librairie [setuptools](https://pypi.org/project/setuptools/), 
- â†—ï¸â˜ï¸ Elles se publient dans PyPI via la librairie [twine](https://pypi.org/project/twine/)
- â¬‡ï¸ğŸ’» Et se tÃ©lÃ©chargent avec la librairie [pip](https://pypi.org/project/pip/)

![](images/schema-packaging-cinematique.png)

</script></section><section data-markdown><script type="text/template">

## Le setup, avec `setup.py`

```python
from setuptools import setup

setup(
  name='Distutils',
  version='1.0',
  description='ğŸ§  â• ğŸ“¦ = â¤ï¸',
  author='Crafting Datascience',
  author_email='crafting.datascience@gmail.com',
  url='https://www.meetup.com/fr-FR/crafting-datascience/',
  packages=['distutils', 'distutils.command', ...],
)
```

</script></section><section data-markdown><script type="text/template">

## Le setup, avec `setup.cfg`

> Parce que dÃ©crire de la configuration avec du code exÃ©cutable,
> c'est la porte ouverte Ã  toutes les fenÃªtres ğŸªŸğŸªŸğŸªŸ

<span style="float: right;">-- Mehdi H. 2022</span>

</script></section><section data-markdown><script type="text/template">

## Le setup, avec `setup.cfg`

```python
# setup.py
from setuptools import setup

setup()
```

```toml
# setup.cfg
[metadata]
name = presentation-packaging-machine-learning
version = 1.0
author = Mehdi Houacine
author_email = mehdi.houacine@octo.com
home-page = https://github.com/Mehdi-H/presentation-packaging-machine-learning
license = <une licence in-croy-able>
description = <une description surprenante>
platform = any
classifiers =
   Programming Language :: Python :: 3
   Intended Audience :: Developers, DataScientists, MLEngineers
   Operating System :: OS Independent
   Bug Tracker = https://github.com/Mehdi-H/presentation-packaging-machine-learning/issues

[options]
zip_safe = false
packages = find:
install_requires =
   numpy==1.19.4
   tensorflow==2.4.0
include_package_data = True
python_requires = >=3.8

[options.entry_points]
console_scripts =
   pkg-ml = presentation_packaging_machine_learning.__main__:main
```

</script></section><section data-markdown><script type="text/template">

## Le saviez-tu ? ğŸ’¡

Le `setup` peut gÃ©nÃ©rer un package <br>[dans d'autres formats](https://docs.python.org/fr/3/distutils/sourcedist.html) que `.whl`

```python
$> python setup.py sdist --formats=gztar,zip;
```

- zip, gztar, bztar, xztar, ztar, tar, ...

</script></section><section data-markdown><script type="text/template">

## Le saviez-tu ? ğŸ’¡

ğŸ¥¸ Le format `wheel`, <br>**c'est un `zip` avec une moustache !**

> A wheel is a ZIP-format archive 
> with a specially formatted file name 
> and the .whl extension

<span style="float: right;">-- <a href="https://peps.python.org/pep-0427/#abstract">PEP-0427</a></span>

</script></section><section data-markdown><script type="text/template">

## Le saviez-tu ? ğŸ’¡

ğŸ¥¸ Le format `wheel`, <br>c'est un `zip` avec une moustache !

```shell
$> unzip -vl pandas-1.4.3-cp310-cp310-win_amd64.whl;


Archive:  pandas-1.4.3-cp310-cp310-win_amd64.whl
 Length   Method    Size  Cmpr    Date    Time   CRC-32   Name
--------  ------  ------- ---- ---------- ----- --------  ----
   10643  Defl:N     3493  67% 06-23-2022 12:34 d5770ab4  pandas/__init__.py
    8812  Defl:N     2956  67% 06-23-2022 12:34 cc32e406  pandas/_typing.py
     518  Defl:N      357  31% 06-23-2022 12:40 b1fb299d  pandas/_version.py
   46176  Defl:N    11329  76% 06-23-2022 12:34 3b2fefd0  pandas/conftest.py
     331  Defl:N      151  54% 06-23-2022 12:33 da86e406  pandas/testing.py
...
```

</script></section><section data-markdown><script type="text/template">

## Packager du ML <br>au format Wheel

#### DÃ©monstration ğŸ¥¸

- ğŸ§  Un modÃ¨le de ML, c'est un fichier <small>(.pkl, .h5, ...)</small>

- â˜¸ï¸ `Setuptools` permet d'embarquer <br>des fichiers dans un Wheel

- â‡’ **`Setuptools` permet de <br>packager du ML au format Wheel ğŸ‰**

</script></section><section data-markdown><script type="text/template">

## Step 1

### Setup.{py,cfg} ğŸ“

```toml
[metadata]
name = presentation-packaging-machine-learning
version = 1.0
...

[options]
...
include_package_data = True  # ğŸ‘ˆ
```

</script></section><section data-markdown><script type="text/template">

## Step 2

### MANIFEST.in ğŸ“

```toml
# MANIFEST.in

## ğŸ‘‡
include models/densenet121_weights_tf_dim_ordering_tf_kernels.h5
```
</script></section><section data-markdown><script type="text/template">

## Step 3

### Build ğŸ”¨

```python
$> python setup.py bdist_wheel;
```

[ou mÃªme mieux](https://peps.python.org/pep-0517/), pour les *cool kids* <small>(PEP 517)</small>

```python
$> python -m build --wheel;
```
</script></section><section data-markdown><script type="text/template">

## Test de recette

- [x] PrÃ©sence du modÃ¨le dans le .whl

```shell
$> unzip -vl dist/presentation_packaging_model-1.0-py3-none-any.whl

Archive:  dist/presentation_packaging_model-1.0-py3-none-any.whl
 Length   Method    Size  Cmpr    Date    Time   CRC-32   Name
--------  ------  ------- ---- ---------- ----- --------  ----
       0  Defl:N        2   0% 07-03-2022 11:58 00000000  presentation_pkg_ml/__init__.py
ğŸš€ 34115984  Defl:N 30329718  11% 07-01-2022 19:53 b0ae32e5  presentation_pkg_ml/densenet121_weights_tf_dim_ordering_tf_kernels.h5
     509  Defl:N      287  44% 07-03-2022 12:10 65037a2e  presentation_pkg_ml/main.py
     559  Defl:N      315  44% 07-03-2022 12:11 a9a8970e  presentation_packaging_model-1.0.dist-info/METADATA
      92  Defl:N       92   0% 07-03-2022 12:11 801a68e9  presentation_packaging_model-1.0.dist-info/WHEEL
      79  Defl:N       68  14% 07-03-2022 12:11 494ecc87  presentation_packaging_model-1.0.dist-info/entry_points.txt
      20  Defl:N       22 -10% 07-03-2022 12:11 5faa91fa  presentation_packaging_model-1.0.dist-info/top_level.txt
     785  Defl:N      452  42% 07-03-2022 12:11 89e36031  presentation_packaging_model-1.0.dist-info/RECORD
--------          -------  ---                            -------
34118028         30330956  11%                            8 files
```

</script></section><section data-markdown><script type="text/template">

## Ne packagez pas Ã  la main âœ‹

### Livrez en continu ğŸš€

![](./images/ci-complete.png)

</script></section></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1531685250784-7569952593d2?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1074&q=80" -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); padding: 20px; font-size: 20px; text-align: center;"><h2 style="color:white;">Est-ce qu'on peut <br>faire mieux ?</h2><p>ğŸ³ â˜¸ï¸ ğŸ“¦ ğŸš€</p></div>

</script></section><section data-markdown><script type="text/template">

![](https://miro.medium.com/max/1400/1*yYSBP2vyb1h5Sky3-n2s_Q.png)

> ***The Wall of Confusion** : one group in a value stream approaches their job as complete when theyâ€™ve passed it onto the next group* <!-- .element: class="fragment" -->

<small>Sources : [S. Kawaguchi - The Wall of Confusion](https://levelup.gitconnected.com/the-wall-of-confusion-623057a4dd26)</small>

</script></section><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1531685250784-7569952593d2?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1074&q=80" -->

## Ce mur existe aussi <br>dans les projets de ML ğŸ§±

</script></section><section data-markdown><script type="text/template">

## Le wheel seul ne suffit pas

### Il faudrait l'accompagner d'une procÃ©dure d'installation ğŸ“

- [ ] DÃ©pendances systÃ¨mes, spÃ©cifiques Ã  l'OS
  - Drivers GPU, paquets Ã  installer avec apt ou yum
- Version de Python bien prÃ©cise
  - python 3 Ã  partir de la version 3.6.5
- Configuration, fichiers de service, ...

ğŸ˜µ ğŸ˜µ ğŸ˜µ

</script></section><section data-markdown><script type="text/template">

### On pourrait se passer de procÃ©dures ğŸ“

### avec des outils de conteneurisation comme Docker ğŸ³

</script></section><section data-markdown><script type="text/template">

## Une image docker ğŸ³

### "Simple"

```dockerfile
FROM python:3.8.0-slim  # ğŸ‘ˆ dÃ©finition de la version de Python nÃ©cessaire, tirÃ©e du dockerhub


# ğŸ‘‡ Installation de dÃ©pendances sur le systÃ¨me
RUN apt-get update \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# ğŸ‘‡ Packaging du modÃ¨le de machine learning
COPY densenet121_weights_tf_dim_ordering_tf_kernels.h5 /app/

# ğŸ‘‡ Packaging des sources python
COPY setup.py setup.cfg MANIFEST.in main.py /app/

# ğŸ‘‡ Installation de dÃ©pendances Python via pip
WORKDIR /app
RUN pip install --user -U pip && pip install .
CMD pkg-ml
```

</script></section><section data-markdown><script type="text/template">

## Une image docker ğŸ³

### Un peu plus Ã©voluÃ©e

```dockerfile
# ğŸ‘‡ Ã©tape de production du modÃ¨le : 
## il peut Ãªtre gÃ©nÃ©rÃ© ici ou tÃ©lÃ©chargÃ© depuis un dÃ©pÃ´t de modÃ¨les
FROM python:3.8.0-slim as model-builder
... 
# ğŸ‘‡ GÃ©nÃ©ration des data
FROM python:3.8.0-slim as data-builder
... 
# ğŸ‘‡ GÃ©nÃ©ration de la Wheel
FROM python:3.8.0-slim as app-builder
... 
# ğŸ‘‡ GÃ©nÃ©ration de l'image rÃ©sultante Ã  publier
FROM python:3.8.0-slim as app
â€¦ 
```

(avec *[multi-stage build](https://docs.docker.com/develop/develop-images/multistage-build/)*)

</script></section></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1614728263952-84ea256f9679?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2808&q=80" class="white-text" -->

<div style="position: absolute; width: 100%; box-shadow: 0 1px 4px rgba(0,0,0,0.7), 0 5px 25px rgba(0,0,0,0.5); background-color: rgba(0, 0, 0, 0.7); padding: 20px; font-size: 30px; text-align: center;">
  <h2 style="color:white;">
    Les stratÃ©gies de dÃ©ploiement ğŸš€
  </h2>
  <h3 style="color:white;">
    impactent la faÃ§on de packager ğŸ“¦
  </h3>
</div>

</script></section><section data-markdown><script type="text/template">

## Qu'a-t-on fait jusque lÃ  ?

![](./images/package.png)

1. Avec un `zip` ğŸ“¦

</script></section><section data-markdown><script type="text/template">

## Qu'a-t-on fait jusque lÃ  ?

![](./images/package.png)

2. Avec un `Wheel` ğŸ

</script></section><section data-markdown><script type="text/template">

## Qu'a-t-on fait jusque lÃ  ?

![](./images/package.png)

3. Avec un `conteneur docker`  ğŸ³

</script></section><section data-markdown><script type="text/template">

## Le point commun ?

On a pris une dÃ©cision d'architecture forte,

(peut-Ãªtre invonlontairement)

</script></section><section data-markdown><script type="text/template">

## Le point commun â“

Nous avons crÃ©Ã© un couplage fort entre :

- ğŸ“ le code
- ğŸ§  et le modÃ¨le

</script></section><section data-markdown><script type="text/template">

![](https://blog.octo.com/wp-content/uploads/2021/03/schema-modele-embarque.png)

DÃ©ploiement avec *modÃ¨le embarquÃ©* 

ğŸ“ğŸ”—ğŸ§ 

</script></section><section data-markdown><script type="text/template">

## Comment faire si ...

- ğŸ§  je veux dÃ©ployer ***uniquement*** une nouvelle version du modÃ¨le ?

- ğŸ“ je veux dÃ©ployer ***uniquement*** une nouvelle version du code mÃ©tier ?

</script></section><section data-markdown><script type="text/template">

![](https://blog.octo.com/wp-content/uploads/2021/03/schema-model-separe-en-tant-que-service.png)

DÃ©ploiement avec *modÃ¨le isolÃ© en tant que service* 

ğŸ“â†”ï¸ğŸ§ 

</script></section></section><section ><section data-markdown><script type="text/template">

<!-- .slide: data-background="https://images.unsplash.com/photo-1594392175511-30eca83d51c8?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80" class="white-text" -->

<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); padding: 20px; font-size: 20px; text-align: center;"><h2 style="color:white;">Take away</h2><p>ğŸ¥¡ ğŸ¥¡ ğŸ¥¡</p></div>

</script></section><section data-markdown><script type="text/template">

#### Vous n'avez pas envie de packager votre application de ML dans un Zip ğŸ¤“

Il y a des outils dans l'Ã©co-systÃ¨me Python faits pour Ã§a
(*[Les piles sont incluses ğŸ”‹](http://localhost:1948/slides.md#/6/4) !*)

</script></section><section data-markdown><script type="text/template">

#### â˜¸ï¸ Utilisez le format Wheel

#### pour Ã©viter de rÃ©inventer la roue ğŸ

ğŸ¥ğŸ¥ğŸ¥

</script></section><section data-markdown><script type="text/template">

#### â˜¸ï¸ Le format Wheel, 

#### c'est un zip avec une moustache ğŸ¥¸

</script></section><section data-markdown><script type="text/template">
## Ne packagez pas Ã  la main âœ‹

### Livrez en continu ğŸš€

![](./images/ci-complete.png)

</script></section><section data-markdown><script type="text/template">

#### La stratÃ©gie de packaging

#### influe sur la stratÃ©gie de dÃ©ploiement ğŸš€

- ğŸ“ğŸ”—ğŸ§  | ModÃ¨le *embarquÃ©*
- ğŸ“â†”ï¸ğŸ§  | ModÃ¨le *isolÃ© en tant que service*

> Si vous ne vous occupez pas de votre packaging, c'est lui qui s'occupera de vous ! <!-- .element: class="fragment" -->

</script></section><section data-markdown><script type="text/template">

Lisez CD4ML, c'est bon pour la santÃ© âœ…

[![](./images/cd4ml-article-blog.png)](https://martinfowler.com/articles/cd4ml.html)

</script></section><section data-markdown><script type="text/template">

#### J'ai rÃ©digÃ© un article de blog sur le sujet

[![](./images/mon-article-blog-octo.png)](https://blog.octo.com/amener-son-projet-de-machine-learning-jusquen-production-avec-wheel-et-docker/)

<small>Ca parle de packaging, de muffins et de chihuahua ğŸ¶</small>

</script></section></section><section  data-markdown><script type="text/template">

<img src="./images/logo.png" height="200">

## Merci ğŸ‘‹

<style>
    body.reveal-viewport {
        background-image: url(images/meetup.png), url(images/logo.png);
        background-repeat: no-repeat;
        background-position: bottom 20px right 150px, bottom 20px right 220px;
        background-size: auto 5%, auto 5%;
    }
    .round-border {
        border-radius: 2%;
    }
</style></script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"transition":"fade"}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
